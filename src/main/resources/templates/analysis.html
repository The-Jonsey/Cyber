<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
    <head>
        <meta charset="UTF-8">
        <title>Netstat - Analysis</title>
    </head>
    <body>
        <th:block th:insert="~{header::copy}"></th:block>
        <canvas id="myChart" width="400" height="400"></canvas>
        <th:block th:insert="~{footer::copy}"></th:block>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>
        <script>
            let columns = JSON.parse("[[${columnCounts}]]".replace(/&quot;/g, '"'));
            let colors = ["#33cc33"];
            let color1 = colors[0];
            let color2 = "#cc3333";
            console.log(columns);
            let ratio = 1 / Object.keys(columns).length;
            for (i = 1; i < Object.keys(columns).length - 1; i++) {
                var hex = function (x) {
                    x = x.toString(16);
                    return (x.length === 1) ? '0' + x : x;
                };

                var r = Math.ceil(parseInt(color2.substring(1, 3), 16) * (i*ratio) + parseInt(color1.substring(1, 3), 16) * (1 - (i*ratio)));
                var g = Math.ceil(parseInt(color2.substring(3, 5), 16) * (i*ratio) + parseInt(color1.substring(3, 5), 16) * (1 - (i*ratio)));
                //var b = Math.ceil(parseInt(color1.substring(4, 6), 16) * (i*ratio) + parseInt(color2.substring(4, 6), 16) * (1 - (i*ratio)));
                colors.push("#" + hex(r) + hex(g) + "33");
            }
            colors.push(color2);
            console.log(colors);
            var ctx = document.getElementById('myChart').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(columns),
                    datasets: [{
                        label: 'Number of Records',
                        data: Object.values(columns),
                        backgroundColor: colors
                    }]
                },
                options: {
                    elements: {
                        arc: {
                            borderWidth: 0
                        }
                    }
                }
            });
        </script>
    </body>
</html>