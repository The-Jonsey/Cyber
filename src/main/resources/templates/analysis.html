<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
    <head>
        <meta charset="UTF-8">
        <title th:text="${title + ' - Analysis'}"></title>
        <link rel="stylesheet" href="static/css/index.css">
    </head>
    <body>
    <th:block th:insert="header :: copy(${title})"></th:block>
        <div class="container-fluid" style="position: relative">
            <div class="col-md-5" style="display: inline-block">
                <canvas id="myChart" width="400" height="400"></canvas>
            </div>
            <div class="col-md-5" style="display: inline-block; float: right; position: absolute">
                <table class="table table-striped" style="float: right">
                    <thead>
                    <tr>
                        <th>Value</th>
                        <th>Count</th>
                    </tr>
                    </thead>
                    <tbody>
                        <th:block th:each="item : ${columnCounts}">
                            <tr>
                                <td th:text="${item.key}"></td>
                                <td th:text="${item.value}"></td>
                            </tr>
                        </th:block>
                    </tbody>
                </table>
            </div>
        </div>
        <th:block th:insert="~{footer::copy}"></th:block>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>
        <script>
            console.log("[[${columnJSON}]]".replace(/&quot;/g, '"'));
            let columns = JSON.parse("[[${columnJSON}]]".replace(/&quot;/g, '"'));
            var sortable = [];
            for (var col in columns) {
                sortable.push([col, columns[col]]);
            }

            sortable.sort(function(a, b) {
                return a[1] - b[1];
            });
            columns = {};
            sortable.forEach(function(i) {
                columns[i[0]] = i[1];
            });
            let colors = ["#cc3333"];
            let color1 = colors[0];
            let color2 = "#33cc33";
            let ratio = 1 / (Object.keys(columns).length - 1);
            for (i = 1; i < Object.keys(columns).length - 1; i++) {
                var hex = function (x) {
                    x = x.toString(16);
                    return (x.length === 1) ? '0' + x : x;
                };

                var r = Math.ceil(parseInt(color2.substring(1, 3), 16) * (i*ratio) + parseInt(color1.substring(1, 3), 16) * (1 - (i*ratio)));
                var g = Math.ceil(parseInt(color2.substring(3, 5), 16) * (i*ratio) + parseInt(color1.substring(3, 5), 16) * (1 - (i*ratio)));
                var b = Math.ceil(parseInt(color2.substring(5, 7), 16) * (i*ratio) + parseInt(color1.substring(5, 7), 16) * (1 - (i*ratio)));
                colors.push("#" + hex(r) + hex(g) + hex(b));
            }
            colors.push(color2);
            console.log(colors);
            var ctx = document.getElementById('myChart').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(columns),
                    datasets: [{
                        label: 'Number of Records',
                        data: Object.values(columns),
                        backgroundColor: colors
                    }]
                },
                options: {
                    elements: {
                        arc: {
                            borderWidth: 0
                        }
                    }
                }
            });
        </script>
    </body>
</html>